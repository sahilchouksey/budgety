var budgetController=function(){var a=function(a,b,c){this.id=a,this.description=b,this.value=c,this.percentage=-1};a.prototype.calcPercentages=function(a){this.percentage=0<a?Math.round(100*(this.value/a)):-1},a.prototype.getPercentage=function(){return this.percentage};var b=function(a,b,c){this.id=a,this.description=b,this.value=c},c=function(a){var b=0;d.allItems[a].forEach(function(a){b+=a.value}),d.totals[a]=b},d={allItems:{exp:[],inc:[]},totals:{exp:0,inc:0},budget:0,percentage:-1};return{addItem:function(c,e,f){var g,h;return h=0<d.allItems[c].length?d.allItems[c][d.allItems[c].length-1].id+1:0,"exp"===c?g=new a(h,e,f):"inc"==c&&(g=new b(h,e,f)),d.allItems[c].push(g),g},deleteItem:function(a,b){var c,e;c=d.allItems[a].map(function(a){return a.id}),e=c.indexOf(b),-1!==e&&d.allItems[a].splice(e,1)},calculateBudget:function(){c("exp"),c("inc"),d.budget=d.totals.inc-d.totals.exp,d.percentage=0<d.totals.inc?Math.round(100*(d.totals.exp/d.totals.inc)):-1},totalPercentages:function(){d.allItems.exp.forEach(function(a){a.calcPercentages(d.totals.inc)})},getPercentages:function(){var a=d.allItems.exp.map(function(a){return a.getPercentage()});return a},getBudget:function(){return{budget:d.budget,totalInc:d.totals.inc,totalExp:d.totals.exp,percentage:d.percentage}},testing:function(){console.log(d)}}}(),UIController=function(){var a={inputType:".add__type",inputDescription:".add__description",inputValue:".add__value",inputBtn:".add__btn",incomeContainer:".income__list",expensesContainer:".expenses__list",budgetLabel:".budget__value",incomeLabel:".budget__income--value",expensesLabel:".budget__expenses--value",percentageLabel:".budget__expenses--percentage",container:".container",expPercentageLabel:".item__percentage",dateLabel:".budget__title--month"},b=function(a,b){var c,d,b;return a=Math.abs(a),a=a.toFixed(2),c=a.split("."),int=c[0],3<int.length&&(int=int.substr(0,int.length-3)+","+int.substr(int.length-3,3)),d=c[1],("exp"===b?"-":"+")+" "+int+"."+d},c=function(a,b){for(var c=0;c<a.length;c++)b(a[c],c)};return{getInput:function(){return{type:document.querySelector(a.inputType).value,description:document.querySelector(a.inputDescription).value,value:parseFloat(document.querySelector(a.inputValue).value)}},addListItem:function(c,d){var e,f,g;"inc"===d?(g=a.incomeContainer,e="<div class=\"item clearfix\" id=\"inc-&id&\"><div class=\"item__description\">&description&</div><div class=\"right clearfix\"><div class=\"item__value\">%value%</div><div class=\"item__delete\"><button class=\"item__delete--btn\"><i class=\"fal fa-minus-circle\"></i></button></div></div></div>"):"exp"==d&&(g=a.expensesContainer,e="<div class=\"item clearfix\" id=\"exp-&id&\"><div class=\"item__description\">&description&</div><div class=\"right clearfix\"><div class=\"item__value\">%value%</div><div class=\"item__percentage\">21%</div><div class=\"item__delete\"><button class=\"item__delete--btn\"><i class=\"fal fa-minus-circle\"></i></button></div></div></div>");f=e.replace("&id&",c.id),f=f.replace("&description&",c.description),f=f.replace("%value%",b(c.value,d)),document.querySelector(g).insertAdjacentHTML("beforeend",f)},deleteListItem:function(a){var b=document.getElementById(a);b.parentNode.removeChild(b)},clearFields:function(){var b,c;b=document.querySelectorAll(a.inputDescription+", "+a.inputValue),c=Array.prototype.slice.call(b),c.forEach(function(a){a.value=""}),c[0].focus()},displayBudget:function(c){var d;d=0<c.budget?"inc":"exp",document.querySelector(a.budgetLabel).textContent=b(c.budget,d),document.querySelector(a.incomeLabel).textContent=b(c.totalInc,"inc"),document.querySelector(a.expensesLabel).textContent=b(c.totalExp,"exp"),document.querySelector(a.percentageLabel).textContent=0<c.percentage&&0<c.budget?c.percentage+"%":"---"},displayPercentages:function(c,d){var b,e,f=document.querySelectorAll(a.expPercentageLabel);e=Array.from(f),0<=d.budget?e.forEach((a,b)=>{a.textContent=0<c[b]&&100>=c[b]?c[b]+"%":"---"}):(e.forEach((a,c)=>{b=c}),e[b].textContent="---")},displayMonth:function(){var b,c,d,e,f;b=new Date,c=b.getFullYear(),d=b.getMonth(),f=b.getDate(),e=["January","February","March","April","May","June","July","August","September","October","November","December"],document.querySelector(a.dateLabel).textContent=f+" "+e[d]+" "+c},changedType:function(){var b=document.querySelectorAll(a.inputType+","+a.inputDescription+","+a.inputValue);c(b,function(a){a.classList.toggle("red-focus")}),document.querySelector(a.inputBtn).classList.toggle("red")},getDOMStrings:function(){return a}}}(),controller=function(a,b){var c,d=function(){var a=b.getDOMStrings();document.querySelector(a.inputBtn).addEventListener("click",g),document.addEventListener("keypress",function(a){(13===a.keyCode||13===a.which)&&g()}),document.querySelector(a.container).addEventListener("click",h),document.querySelector(a.inputType).addEventListener("change",b.changedType)},e=function(){a.calculateBudget(),c=a.getBudget(),b.displayBudget(c)},f=function(){a.totalPercentages();var d=a.getPercentages();b.displayPercentages(d,c)},g=function(){var c,d;c=b.getInput(),""!==c.description&&!isNaN(c.value)&&0<c.value&&(d=a.addItem(c.type,c.description,c.value),b.addListItem(d,c.type),b.clearFields()),e(),f()},h=function(c){var d,g,h,i;d=c.target.parentNode.parentNode.parentNode.parentNode.id,d&&(g=d.split("-"),h=g[0],i=parseInt(g[1]),a.deleteItem(h,i),b.deleteListItem(d),e(),f())};return{init:function(){console.log("Application has started."),b.displayMonth(),d(),b.displayBudget({budget:0,totalInc:0,totalExp:0,percentage:-1})}}}(budgetController,UIController);controller.init();
